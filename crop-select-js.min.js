/*!
 * CropSelectJs - https://zara4.com/projects/crop-select-js
 *
 * Copyright (c) 2017 Zara 4
 *
 * Released under the GNU GPL 3.0 License
 * @license https://github.com/zara-4/crop-select-js/blob/master/LICENSE.md
 *
 */
function CropSelectJs(elem,options){this.elem=jQuery(elem),this.options=$.extend({},{animatedBorder:null!=this.elem.data("animated-border")?this.elem.data("animated-border"):!0,aspectRatio:null!=this.elem.data("aspect-ratio")?this.elem.data("aspect-ratio"):null,imageSrc:null,imageWidth:null,imageHeight:null,selectionResize:function(){},selectionMove:function(){}},options);var $this=this;$(elem).bind(CropSelectJs.EVENT_NAME__SELECTION_RESIZE,function(event,data){$this.options.selectionResize(data)}),$(elem).bind(CropSelectJs.EVENT_NAME__SELECTION_MOVE,function(event,data){$this.options.selectionMove(data)}),this.elem.hasClass("crop-select-js")||this.elem.addClass("crop-select-js"),this.initialiseWrapper(),this.initialiseSelectionBox(),this.initialiseShadows(),this.initialiseImage(),this.elem.empty(),this.elem.append(this.wrapper),$(window).on("mouseup",function(e){$this.handleMouseUp(e)}),$(window).on("mousemove",function(e){$this.handleMouseMove(e)}),$(window).on("resize",function(){$this.handleWrapperResize()}),$(this.cropImage).on("load",function(){$this.handleImageLoad()}),this.options.animatedBorder?this.enableAnimatedBorder():this.disableAnimatedBorder(),this.options.imageSrc&&this.setImageSrc(this.options.imageSrc)}!function($){var methods={init:function(arguments){return this.data("cropselectjs",new CropSelectJs(this,arguments)),this},enableAnimatedBorder:function(){return this.data("cropselectjs").enableAnimatedBorder()},disableAnimatedBorder:function(){return this.data("cropselectjs").disableAnimatedBorder()},getSelectionBoxX:function(){return this.data("cropselectjs").getSelectionBoxX()},setSelectionBoxX:function(x){return this.data("cropselectjs").setSelectionBoxX(x)},getSelectionBoxY:function(){return this.data("cropselectjs").getSelectionBoxY()},setSelectionBoxY:function(y){return this.data("cropselectjs").setSelectionBoxY(y)},getSelectionBoxWidth:function(){return this.data("cropselectjs").getSelectionBoxWidth()},setSelectionBoxWidth:function(width){return this.data("cropselectjs").setSelectionBoxWidth(width)},getSelectionBoxHeight:function(){return this.data("cropselectjs").getSelectionBoxHeight()},setSelectionBoxHeight:function(height){return this.data("cropselectjs").setSelectionBoxHeight(height)},setSelectionAspectRatio:function(aspectRatio){return this.data("cropselectjs").setSelectionAspectRatio(aspectRatio)},clearSelectionAspectRatio:function(aspectRatio){return this.data("cropselectjs").clearSelectionAspectRatio(aspectRatio)},getImageSrc:function(){return this.data("cropselectjs").getImageSrc()},getImageWidth:function(){return this.data("cropselectjs").getImageWidth()},getImageHeight:function(){return this.data("cropselectjs").getImageHeight()},getImageAspectRatio:function(){return this.data("cropselectjs").getImageAspectRatio()},setImageSrc:function(src){return this.data("cropselectjs").setImageSrc(src)},selectEverything:function(){this.data("cropselectjs").selectEverything()},selectCentredSquare:function(){this.data("cropselectjs").selectCentredSquare()},selectCentredFittedAspectRatio:function(aspectRatio){this.data("cropselectjs").selectCentredFittedAspectRatio(aspectRatio)}};$.fn.CropSelectJs=function(methodOrOptions){return methods[methodOrOptions]?methods[methodOrOptions].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof methodOrOptions&&methodOrOptions?void $.error("Method "+methodOrOptions+" does not exist on jQuery.CropSelectJs"):methods.init.apply(this,arguments)}}(jQuery),CropSelectJs.prototype.constructor=CropSelectJs,CropSelectJs.MINIMUM_SELECTION_BOX_WIDTH=50,CropSelectJs.MINIMUM_SELECTION_BOX_HEIGHT=50,CropSelectJs.EVENT_NAME__SELECTION_RESIZE="crop-select-js.selection.resize",CropSelectJs.EVENT_NAME__SELECTION_MOVE="crop-select-js.selection.move",CropSelectJs.prototype.initialiseWrapper=function(){this.wrapper=this.elem.find(".crop-wrapper"),this.wrapper[0]?this.wrapper.detach():this.wrapper=$("<div class='crop-wrapper'></div>")[0]},CropSelectJs.prototype.initialiseSelectionBox=function(){var $this=this;this.selectionBox=this.elem.find(".crop-selection"),this.selectionBox[0]?this.selectionBox.detach():this.selectionBox=$("<div class='crop-selection'><div class='border left'></div><div class='border top'></div><div class='border right'></div><div class='border bottom'></div><div class='handle top-left'></div><div class='handle top'></div><div class='handle top-right'></div><div class='handle right'></div><div class='handle bottom-right'></div><div class='handle bottom'></div><div class='handle bottom-left'></div><div class='handle left'></div></div>")[0],this.wrapper.append(this.selectionBox),$(this.selectionBox).on("mousedown",function(e){$this.handleMouseDownInsideSelectionBox(e)})},CropSelectJs.prototype.initialiseShadows=function(){this.cropShadowLeft=this.elem.find(".shadow.left"),this.cropShadowLeft[0]?this.cropShadowLeft.detach():this.cropShadowLeft=$("<div class='shadow left'></div>")[0],this.wrapper.append(this.cropShadowLeft),this.cropShadowRight=this.elem.find(".shadow.right"),this.cropShadowRight[0]?this.cropShadowRight.detach():this.cropShadowRight=$("<div class='shadow right'></div>")[0],this.wrapper.append(this.cropShadowRight),this.cropShadowTop=this.elem.find(".shadow.top"),this.cropShadowTop[0]?this.cropShadowTop.detach():this.cropShadowTop=$("<div class='shadow top'></div>")[0],this.wrapper.append(this.cropShadowTop),this.cropShadowBottom=this.elem.find(".shadow.bottom"),this.cropShadowBottom[0]?this.cropShadowBottom.detach():this.cropShadowBottom=$("<div class='shadow bottom'></div>")[0],this.wrapper.append(this.cropShadowBottom)},CropSelectJs.prototype.initialiseImage=function(){this.cropImage=this.elem.find(".crop-image"),this.cropImage[0]?this.cropImage.detach():this.cropImage=$("<img class='crop-image' />")[0],this.wrapper.append(this.cropImage)},CropSelectJs.prototype.handleMouseUp=function(e){this.cropSelectionMouseStartX=null,this.cropSelectionMouseStartY=null,this.cropSelectionStartX=null,this.cropSelectionStartY=null,this.cropSelectionStartWidth=null,this.cropSelectionStartHeight=null,this.cropSelectionResizeHandle=null},CropSelectJs.prototype.handleMouseMove=function(e){if(this.cropSelectionMouseStartX&&this.cropSelectionMouseStartY){var changeX=e.pageX-this.cropSelectionMouseStartX,changeY=e.pageY-this.cropSelectionMouseStartY;this.cropSelectionResizeHandle?(null==this.options.aspectRatio?this.handleFreeResize(changeX,changeY):"top-left"==this.cropSelectionResizeHandle?this.handleAspectRatioLockedResizeTopLeft(changeX,changeY,this.options.aspectRatio):"top"==this.cropSelectionResizeHandle?this.handleAspectRatioLockedResizeTop(changeX,changeY,this.options.aspectRatio):"top-right"==this.cropSelectionResizeHandle?this.handleAspectRatioLockedResizeTopRight(changeX,changeY,this.options.aspectRatio):"right"==this.cropSelectionResizeHandle?this.handleAspectRatioLockedResizeRight(changeX,changeY,this.options.aspectRatio):"bottom-right"==this.cropSelectionResizeHandle?this.handleAspectRatioLockedResizeBottomRight(changeX,changeY,this.options.aspectRatio):"bottom"==this.cropSelectionResizeHandle?this.handleAspectRatioLockedResizeBottom(changeX,changeY,this.options.aspectRatio):"bottom-left"==this.cropSelectionResizeHandle?this.handleAspectRatioLockedResizeBottomLeft(changeX,changeY,this.options.aspectRatio):"left"==this.cropSelectionResizeHandle&&this.handleAspectRatioLockedResizeLeft(changeX,changeY,this.options.aspectRatio),this.triggerSelectionResizeEvent(),this.getSelectionBoxX()==this.cropSelectionStartX&&this.getSelectionBoxY()==this.cropSelectionStartY||this.triggerSelectionMoveEvent()):(this.setSelectionBoxX(this.cropSelectionStartX+changeX),this.setSelectionBoxY(this.cropSelectionStartY+changeY),this.triggerSelectionMoveEvent())}},CropSelectJs.prototype.handleMouseDownInsideSelectionBox=function(e){this.cropSelectionMouseStartX=e.pageX,this.cropSelectionMouseStartY=e.pageY,this.cropSelectionStartX=this.getSelectionBoxX(),this.cropSelectionStartY=this.getSelectionBoxY(),this.cropSelectionStartWidth=this.getSelectionBoxWidth(),this.cropSelectionStartHeight=this.getSelectionBoxHeight();var target=$(e.target);target.hasClass("handle")&&(target.hasClass("top-left")&&(this.cropSelectionResizeHandle="top-left"),target.hasClass("top")&&(this.cropSelectionResizeHandle="top"),target.hasClass("top-right")&&(this.cropSelectionResizeHandle="top-right"),target.hasClass("right")&&(this.cropSelectionResizeHandle="right"),target.hasClass("bottom-right")&&(this.cropSelectionResizeHandle="bottom-right"),target.hasClass("bottom")&&(this.cropSelectionResizeHandle="bottom"),target.hasClass("bottom-left")&&(this.cropSelectionResizeHandle="bottom-left"),target.hasClass("left")&&(this.cropSelectionResizeHandle="left"))},CropSelectJs.prototype.handleWrapperResize=function(){var changeInWrapperWidth=this.previousWrapperWidth-this.getCropWrapperWidth(),changeInWrapperHeight=this.previousWrapperHeight-this.getCropWrapperHeight();if(0!=changeInWrapperWidth||0!=changeInWrapperHeight){var previousImageXScaleFactor=this.getImageWidth()/this.previousWrapperWidth,previousImageYScaleFactor=this.getImageHeight()/this.previousWrapperHeight,previousScaledSelectionBoxWidth=previousImageXScaleFactor*this.getSelectionBoxWidth(),previousScaledSelectionBoxHeight=previousImageYScaleFactor*this.getSelectionBoxHeight(),previousScaledSelectionBoxX=previousImageXScaleFactor*this.getSelectionBoxX(),previousScaledSelectionBoxY=previousImageYScaleFactor*this.getSelectionBoxY(),newImageXScaleFactor=this.getImageXScaleFactor(),newImageYScaleFactor=this.getImageYScaleFactor(),newSelectionBoxWidth=Math.round(previousScaledSelectionBoxWidth/newImageXScaleFactor),newSelectionBoxHeight=Math.round(previousScaledSelectionBoxHeight/newImageYScaleFactor),newSelectionBoxX=Math.round(previousScaledSelectionBoxX/newImageXScaleFactor),newSelectionBoxY=Math.round(previousScaledSelectionBoxY/newImageYScaleFactor);this.setSelectionBoxWidth(newSelectionBoxWidth),this.setSelectionBoxHeight(newSelectionBoxHeight),this.setSelectionBoxX(newSelectionBoxX),this.setSelectionBoxY(newSelectionBoxY),this.previousWrapperWidth=this.getCropWrapperWidth(),this.previousWrapperHeight=this.getCropWrapperHeight(),this.triggerSelectionResizeEvent(),this.triggerSelectionMoveEvent()}},CropSelectJs.prototype.handleImageLoad=function(){this.previousWrapperWidth=this.getCropWrapperWidth(),this.previousWrapperHeight=this.getCropWrapperHeight(),this.options.aspectRatio?this.selectCentredFittedAspectRatio(this.options.aspectRatio):this.selectEverything()},CropSelectJs.prototype.triggerSelectionResizeEvent=function(){$(this.elem).trigger(CropSelectJs.EVENT_NAME__SELECTION_RESIZE,{width:this.getSelectionBoxWidth(),height:this.getSelectionBoxWidth(),widthScaledToImage:this.getScaledSelectionBoxWidth(),heightScaledToImage:this.getScaledSelectionBoxHeight()})},CropSelectJs.prototype.triggerSelectionMoveEvent=function(){$(this.elem).trigger(CropSelectJs.EVENT_NAME__SELECTION_MOVE,{x:this.getSelectionBoxX(),y:this.getSelectionBoxY(),xScaledToImage:this.getScaledSelectionBoxX(),yScaledToImage:this.getScaledSelectionBoxY()})},CropSelectJs.prototype.handleFreeResize=function(changeX,changeY){this.cropSelectionResizeHandle.includes("top")?(this.setSelectionBoxHeight(Math.min(this.cropSelectionStartHeight-changeY,this.cropSelectionStartY+this.cropSelectionStartHeight)),this.setSelectionBoxY(Math.min(this.cropSelectionStartY+changeY,this.cropSelectionStartY+this.cropSelectionStartHeight-CropSelectJs.MINIMUM_SELECTION_BOX_HEIGHT))):this.cropSelectionResizeHandle.includes("bottom")&&this.setSelectionBoxHeight(Math.min(this.cropSelectionStartHeight+changeY,this.getCropWrapperHeight()-this.cropSelectionStartY)),this.cropSelectionResizeHandle.includes("left")?(this.setSelectionBoxWidth(Math.min(this.cropSelectionStartWidth-changeX,this.cropSelectionStartX+this.cropSelectionStartWidth)),this.setSelectionBoxX(Math.min(this.cropSelectionStartX+changeX,this.cropSelectionStartX+this.cropSelectionStartWidth-CropSelectJs.MINIMUM_SELECTION_BOX_WIDTH))):this.cropSelectionResizeHandle.includes("right")&&this.setSelectionBoxWidth(Math.min(this.cropSelectionStartWidth+changeX,this.getCropWrapperWidth()-this.cropSelectionStartX))},CropSelectJs.prototype.handleAspectRatioLockedResizeTopLeft=function(changeX,changeY,aspectRatio){var maxHeight=this.cropSelectionStartY+this.cropSelectionStartHeight,maxWidth=this.cropSelectionStartX+this.cropSelectionStartWidth;maxWidth=Math.min(maxWidth,maxHeight*aspectRatio),maxHeight=Math.min(maxHeight,maxWidth/aspectRatio);var newHeight,newWidth,calculatedHeight=Math.min(this.cropSelectionStartHeight-changeY,maxHeight),calculatedWidth=Math.min(this.cropSelectionStartWidth-changeX,maxWidth),aspectCalculatedWidth=calculatedHeight*aspectRatio,aspectCalculatedHeight=calculatedWidth/aspectRatio;calculatedWidth>aspectCalculatedWidth?(newWidth=calculatedWidth,newHeight=aspectCalculatedHeight):(newHeight=calculatedHeight,newWidth=aspectCalculatedWidth);var actualChangeInWidth=newWidth-this.cropSelectionStartWidth,actualChangeInHeight=newHeight-this.cropSelectionStartHeight,newX=this.cropSelectionStartX-actualChangeInWidth,newY=this.cropSelectionStartY-actualChangeInHeight;newX=Math.min(newX,this.cropSelectionStartX+this.cropSelectionStartWidth-CropSelectJs.MINIMUM_SELECTION_BOX_WIDTH),newY=Math.min(newY,this.cropSelectionStartY+this.cropSelectionStartHeight-CropSelectJs.MINIMUM_SELECTION_BOX_HEIGHT),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight),this.setSelectionBoxX(newX),this.setSelectionBoxY(newY)},CropSelectJs.prototype.handleAspectRatioLockedResizeTop=function(changeX,changeY,aspectRatio){var maxHeight=this.cropSelectionStartY+this.cropSelectionStartHeight,maxWidth=this.cropSelectionStartX+this.cropSelectionStartWidth,newHeight=Math.min(this.cropSelectionStartHeight-changeY,maxHeight),newWidth=newHeight*aspectRatio;newWidth>maxWidth&&(newWidth=maxWidth,newHeight=newWidth/aspectRatio);var actualChangeInWidth=newWidth-this.cropSelectionStartWidth,actualChangeInHeight=newHeight-this.cropSelectionStartHeight,newX=this.cropSelectionStartX-actualChangeInWidth,newY=this.cropSelectionStartY-actualChangeInHeight;newX=Math.min(newX,this.cropSelectionStartX+this.cropSelectionStartWidth-CropSelectJs.MINIMUM_SELECTION_BOX_WIDTH),newY=Math.min(newY,this.cropSelectionStartY+this.cropSelectionStartHeight-CropSelectJs.MINIMUM_SELECTION_BOX_HEIGHT),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight),this.setSelectionBoxX(newX),this.setSelectionBoxY(newY)},CropSelectJs.prototype.handleAspectRatioLockedResizeTopRight=function(changeX,changeY,aspectRatio){var maxWidth=this.getCropWrapperWidth()-this.cropSelectionStartX,maxHeight=this.cropSelectionStartY+this.cropSelectionStartHeight;maxWidth=Math.min(maxWidth,maxHeight*aspectRatio),maxHeight=Math.min(maxHeight,maxWidth/aspectRatio);var newHeight,newWidth,calculatedHeight=Math.min(this.cropSelectionStartHeight-changeY,maxHeight),calculatedWidth=Math.min(this.cropSelectionStartWidth+changeX,maxWidth),aspectCalculatedWidth=calculatedHeight*aspectRatio,aspectCalculatedHeight=calculatedWidth/aspectRatio;calculatedWidth>aspectCalculatedWidth?(newWidth=calculatedWidth,newHeight=aspectCalculatedHeight):(newHeight=calculatedHeight,newWidth=aspectCalculatedWidth);var actualChangeInHeight=newHeight-this.cropSelectionStartHeight,newY=this.cropSelectionStartY-actualChangeInHeight;newY=Math.max(newY,this.cropSelectionStartY-maxHeight),newY=Math.min(newY,this.cropSelectionStartY+this.cropSelectionStartHeight-CropSelectJs.MINIMUM_SELECTION_BOX_HEIGHT),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight),this.setSelectionBoxY(newY)},CropSelectJs.prototype.handleAspectRatioLockedResizeRight=function(changeX,changeY,aspectRatio){var maxHeight=this.getCropWrapperHeight()-this.cropSelectionStartY,maxWidth=this.getCropWrapperWidth()-this.cropSelectionStartX,newWidth=Math.min(this.cropSelectionStartWidth+changeX,maxWidth),newHeight=newWidth/aspectRatio;newHeight>maxHeight&&(newHeight=maxHeight,newWidth=newHeight*aspectRatio),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight)},CropSelectJs.prototype.handleAspectRatioLockedResizeBottomRight=function(changeX,changeY,aspectRatio){var maxHeight=this.getCropWrapperHeight()-this.cropSelectionStartY,maxWidth=this.getCropWrapperWidth()-this.cropSelectionStartX;maxWidth=Math.min(maxWidth,maxHeight*aspectRatio),maxHeight=Math.min(maxHeight,maxWidth/aspectRatio);var newWidth,newHeight,calculatedHeight=Math.min(this.cropSelectionStartHeight+changeY,maxHeight),calculatedWidth=Math.min(this.cropSelectionStartWidth+changeX,maxWidth),aspectCalculatedWidth=calculatedHeight*aspectRatio,aspectCalculatedHeight=calculatedWidth/aspectRatio;calculatedWidth>aspectCalculatedWidth?(newWidth=calculatedWidth,newHeight=aspectCalculatedHeight):(newHeight=calculatedHeight,newWidth=aspectCalculatedWidth),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight)},CropSelectJs.prototype.handleAspectRatioLockedResizeBottom=function(changeX,changeY,aspectRatio){var maxHeight=this.getCropWrapperHeight()-this.cropSelectionStartY,maxWidth=this.getCropWrapperWidth()-this.cropSelectionStartX,newHeight=Math.min(this.cropSelectionStartHeight+changeY,maxHeight),newWidth=newHeight*aspectRatio;newWidth>maxWidth&&(newWidth=maxWidth,newHeight=newWidth/aspectRatio),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight)},CropSelectJs.prototype.handleAspectRatioLockedResizeBottomLeft=function(changeX,changeY,aspectRatio){var maxWidth=this.cropSelectionStartX+this.cropSelectionStartWidth,maxHeight=this.getCropWrapperHeight()-this.cropSelectionStartY;maxWidth=Math.min(maxWidth,maxHeight*aspectRatio),maxHeight=Math.min(maxHeight,maxWidth/aspectRatio);var newHeight,newWidth,calculatedWidth=Math.min(this.cropSelectionStartWidth-changeX,maxWidth),calculatedHeight=Math.min(this.cropSelectionStartHeight+changeY,maxHeight),aspectCalculatedWidth=calculatedHeight*aspectRatio,aspectCalculatedHeight=calculatedWidth/aspectRatio;calculatedWidth>aspectCalculatedWidth?(newWidth=calculatedWidth,newHeight=aspectCalculatedHeight):(newHeight=calculatedHeight,newWidth=aspectCalculatedWidth);var actualChangeInWidth=newWidth-this.cropSelectionStartWidth,newX=this.cropSelectionStartX-actualChangeInWidth;newX=Math.max(newX,this.cropSelectionStartX-maxWidth),newX=Math.min(newX,this.cropSelectionStartX+this.cropSelectionStartWidth-CropSelectJs.MINIMUM_SELECTION_BOX_WIDTH),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight),this.setSelectionBoxX(newX)},CropSelectJs.prototype.handleAspectRatioLockedResizeLeft=function(changeX,changeY,aspectRatio){var maxHeight=this.cropSelectionStartY+this.cropSelectionStartHeight,maxWidth=this.cropSelectionStartX+this.cropSelectionStartWidth,newWidth=Math.min(this.cropSelectionStartHeight-changeX,maxWidth),newHeight=newWidth/aspectRatio;newHeight>maxHeight&&(newHeight=maxHeight,newWidth=newHeight*aspectRatio);var actualChangeInWidth=newWidth-this.cropSelectionStartWidth,actualChangeInHeight=newHeight-this.cropSelectionStartHeight,newX=this.cropSelectionStartX-actualChangeInWidth,newY=this.cropSelectionStartY-actualChangeInHeight;newX=Math.min(newX,this.cropSelectionStartX+this.cropSelectionStartWidth-CropSelectJs.MINIMUM_SELECTION_BOX_WIDTH),newY=Math.min(newY,this.cropSelectionStartY+this.cropSelectionStartHeight-CropSelectJs.MINIMUM_SELECTION_BOX_HEIGHT),this.setSelectionBoxWidth(newWidth),this.setSelectionBoxHeight(newHeight),this.setSelectionBoxX(newX),this.setSelectionBoxY(newY)},CropSelectJs.prototype.enableAnimatedBorder=function(){$(this.selectionBox).addClass("animated")},CropSelectJs.prototype.disableAnimatedBorder=function(){$(this.selectionBox).removeClass("animated")},CropSelectJs.prototype.setSelectionAspectRatio=function(aspectRatio){this.options.aspectRatio=aspectRatio,this.selectCentredFittedAspectRatio(aspectRatio)},CropSelectJs.prototype.clearSelectionAspectRatio=function(){this.options.aspectRatio=null},CropSelectJs.prototype.getCropWrapperWidth=function(){return $(this.wrapper).outerWidth()},CropSelectJs.prototype.getCropWrapperHeight=function(){return $(this.wrapper).outerHeight()},CropSelectJs.prototype.getSelectionBoxX=function(){return $(this.selectionBox).offset().left-$(this.selectionBox).parent().offset().left},CropSelectJs.prototype.setSelectionBoxX=function(x){var wrapperWidth=this.getCropWrapperWidth(),cropSelectionWidth=this.getSelectionBoxWidth();x=Math.max(0,Math.min(x,wrapperWidth-cropSelectionWidth)),this.selectionBox.style.left=x+"px",this.cropShadowLeft.style.width=x+"px",this.cropShadowRight.style.width=wrapperWidth-x-cropSelectionWidth+"px",this.cropShadowTop.style.left=x+"px",this.cropShadowBottom.style.left=x+"px"},CropSelectJs.prototype.getSelectionBoxY=function(){return $(this.selectionBox).offset().top-$(this.selectionBox).parent().offset().top},CropSelectJs.prototype.setSelectionBoxY=function(y){var wrapperHeight=this.getCropWrapperHeight(),cropSelectionHeight=this.getSelectionBoxHeight();y=Math.max(0,Math.min(y,wrapperHeight-cropSelectionHeight)),this.selectionBox.style.top=y+"px",this.cropShadowTop.style.height=y+"px",this.cropShadowBottom.style.height=wrapperHeight-y-cropSelectionHeight+"px"},CropSelectJs.prototype.getSelectionBoxWidth=function(){return $(this.selectionBox).outerWidth()},CropSelectJs.prototype.setSelectionBoxWidth=function(width){width=Math.max(width,CropSelectJs.MINIMUM_SELECTION_BOX_WIDTH),this.selectionBox.style.width=width+"px";var wrapperWidth=this.getCropWrapperWidth();this.cropShadowTop.style.width=width+"px",this.cropShadowBottom.style.width=width+"px",this.cropShadowRight.style.width=wrapperWidth-this.getSelectionBoxX()-width+"px"},CropSelectJs.prototype.getSelectionBoxHeight=function(){return $(this.selectionBox).outerHeight()},CropSelectJs.prototype.setSelectionBoxHeight=function(height){height=Math.max(height,CropSelectJs.MINIMUM_SELECTION_BOX_HEIGHT),this.selectionBox.style.height=height+"px",this.cropShadowBottom.style.height=this.getCropWrapperHeight()-this.getSelectionBoxY()-height+"px"},CropSelectJs.prototype.refreshSelectionBoxShadow=function(){this.setSelectionBoxWidth(this.getSelectionBoxWidth()),this.setSelectionBoxHeight(this.getSelectionBoxHeight()),this.setSelectionBoxX(this.getSelectionBoxX()),this.setSelectionBoxY(this.getSelectionBoxY())},CropSelectJs.prototype.getImageSrc=function(){return $(this.cropImage).attr("src")},CropSelectJs.prototype.setImageSrc=function(imageSrc){var $this=this,img=new Image;img.onload=function(){$this.setImageWidth(this.width),$this.setImageHeight(this.height),$($this.cropImage).attr("src",imageSrc)},img.src=imageSrc},CropSelectJs.prototype.setImageWidth=function(width){this.imageWidth=width},CropSelectJs.prototype.getImageWidth=function(){return this.imageWidth},CropSelectJs.prototype.setImageWidth=function(width){this.imageWidth=width},CropSelectJs.prototype.getImageHeight=function(){return this.imageHeight},CropSelectJs.prototype.setImageHeight=function(height){this.imageHeight=height},CropSelectJs.prototype.getImageAspectRatio=function(){return this.getImageWidth()&&this.getImageHeight()?this.getImageWidth()/this.getImageHeight():null},CropSelectJs.prototype.getImageXScaleFactor=function(){return this.getImageWidth()/$(this.cropImage).width()},CropSelectJs.prototype.getImageYScaleFactor=function(){return this.getImageHeight()/$(this.cropImage).height()},CropSelectJs.prototype.getScaledSelectionBoxWidth=function(){return Math.round(this.getImageXScaleFactor()*this.getSelectionBoxWidth())},CropSelectJs.prototype.getScaledSelectionBoxHeight=function(){return Math.round(this.getImageYScaleFactor()*this.getSelectionBoxHeight())},CropSelectJs.prototype.getScaledSelectionBoxX=function(){return Math.round(this.getImageXScaleFactor()*this.getSelectionBoxX())},CropSelectJs.prototype.getScaledSelectionBoxY=function(){return Math.round(this.getImageYScaleFactor()*this.getSelectionBoxY())},CropSelectJs.prototype.selectEverything=function(){this.setSelectionBoxX(0),this.setSelectionBoxY(0),this.setSelectionBoxWidth(this.getCropWrapperWidth()),this.setSelectionBoxHeight(this.getCropWrapperHeight()),this.triggerSelectionMoveEvent(),this.triggerSelectionResizeEvent()},CropSelectJs.prototype.selectCentredFittedAspectRatio=function(aspectRatio){var width,height,wrapperWidth=this.getCropWrapperWidth(),wrapperHeight=this.getCropWrapperHeight(),aspectCalculatedWidth=wrapperHeight*aspectRatio,aspectCalculatedHeight=wrapperWidth/aspectRatio;aspectCalculatedWidth>wrapperWidth?(width=wrapperWidth,height=Math.round(aspectCalculatedHeight)):(width=Math.round(aspectCalculatedWidth),height=wrapperHeight);var x=Math.floor((wrapperWidth-width)/2),y=Math.floor((wrapperHeight-height)/2);this.setSelectionBoxWidth(width),this.setSelectionBoxHeight(height),this.setSelectionBoxX(x),this.setSelectionBoxY(y),this.triggerSelectionResizeEvent(),this.triggerSelectionMoveEvent()},CropSelectJs.prototype.selectCentredSquare=function(){this.selectCentredFittedAspectRatio(1)};